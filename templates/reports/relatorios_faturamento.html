{% extends "base.html" %}

{% block title %}Relatórios - Faturamento{% endblock %}

{% block body_class %}main-body{% endblock %}

{% block content %}
{% include 'partials/sidebar.html' %}

<main class="content main-content--shifted">
    <div class="content-section active">
        <div class="container-fluid">
            <!-- Header -->
            <div class="page-header">
                <div class="header-content">
                    <i class="fas fa-building"></i>
                    <div class="title-section">
                        <h2 class="page-title">Relatórios de Faturamento</h2>
                        <p class="page-subtitle">Relatórios relacionados ao faturamento e cobrança</p>
                    </div>
                </div>
            </div>

            <!-- Barra de Seleção Rápida -->
            <div class="quick-select-section">
                <div class="quick-select-header">
                    <h5><i class="fas fa-list me-2"></i>Seleção Rápida de Relatórios</h5>
                </div>
                <div class="quick-select-content">
                    <div class="row">
                        <div class="col-md-8">
                            <label for="reportSelect" class="form-label">Selecione o Relatório</label>
                            <select class="form-select" id="reportSelect" onchange="selectReportFromDropdown()">
                                <option value="">Selecione...</option>
                                <!-- Opções serão carregadas dinamicamente dos relatórios configurados -->
                            </select>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button class="btn btn-primary w-100" onclick="openSelectedReport()" id="openReportBtn" disabled>
                                <i class="fas fa-eye me-2"></i>Abrir Relatório
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Área de Favoritos -->
            <div id="favorites-section" class="favorites-section" style="display: none;">
                <div class="favorites-header">
                    <h5><i class="fas fa-star text-warning me-2"></i>Relatórios Favoritos</h5>
                    <button class="btn btn-sm btn-outline-secondary" onclick="clearAllFavorites()">
                        <i class="fas fa-trash"></i> Limpar Todos
                    </button>
                </div>
                <div class="favorites-container" id="favoritesContainer">
                    <!-- Favoritos serão carregados dinamicamente -->
                </div>
            </div>

            <!-- Grid de Relatórios -->
            <div class="reports-grid" id="reportsGrid">
                <!-- Relatórios serão carregados dinamicamente dos configurados -->
            </div>
        </div>
    </div>
</main>

<!-- Modal de Relatório -->
<div class="modal fade" id="reportModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-file-alt me-2"></i>
                    <span id="reportTitle">Relatório</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Filtros do Relatório -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <label for="dateFrom" class="form-label">Data Inicial</label>
                        <input type="date" class="form-control" id="dateFrom">
                    </div>
                    <div class="col-md-3">
                        <label for="dateTo" class="form-label">Data Final</label>
                        <input type="date" class="form-control" id="dateTo">
                    </div>
                    <div class="col-md-3">
                        <label for="filterField" class="form-label">Filtro Adicional</label>
                        <select class="form-select" id="filterField">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button class="btn btn-primary w-100" onclick="generateReport()">
                            <i class="fas fa-search"></i> Gerar Relatório
                        </button>
                    </div>
                </div>

                <!-- Tabela de Dados -->
                <div class="table-responsive" id="reportTableContainer" style="display: none;">
                    <table class="table table-striped" id="reportTable">
                        <thead id="reportTableHead">
                            <!-- Cabeçalhos serão preenchidos dinamicamente -->
                        </thead>
                        <tbody id="reportTableBody">
                            <!-- Dados serão preenchidos dinamicamente -->
                        </tbody>
                    </table>
                </div>

                <!-- Loading State -->
                <div class="text-center py-5" id="loadingState" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-3">Gerando relatório...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ========================================
// DADOS DOS RELATÓRIOS DE FATURAMENTO
// ========================================

// Dados base dos relatórios (mesmos do configurador)
const faturamentoReportsData = {
    'baixas-guias': {
        name: 'Baixas de Guias',
        description: 'Relatório de baixas de guias de faturamento',
        fields: '001*,002*,003,018',
        icon: 'fa-file-invoice-dollar',
        color: 'success',
        columns: ['ID', 'Guia', 'Data Baixa', 'Valor', 'Status'],
        sampleData: [
            ['001', 'GUI-2024-001', '2024-01-15', 'R$ 1.500,00', 'Baixada'],
            ['002', 'GUI-2024-002', '2024-01-20', 'R$ 2.300,00', 'Baixada'],
            ['003', 'GUI-2024-003', '2024-01-25', 'R$ 1.800,00', 'Baixada']
        ]
    },
    'cargas-entregues': {
        name: 'Cargas Entregues',
        description: 'Relatório de cargas entregues para faturamento',
        fields: '001*,002*,003*,006,008,009,011,018',
        icon: 'fa-truck',
        color: 'primary',
        columns: ['ID', 'Cliente', 'Data Entrega', 'Valor', 'Status'],
        sampleData: [
            ['001', 'Empresa ABC Ltda', '2024-01-15', 'R$ 5.000,00', 'Entregue'],
            ['002', 'Comércio XYZ S/A', '2024-01-20', 'R$ 3.500,00', 'Entregue'],
            ['003', 'Indústria DEF Ltda', '2024-01-25', 'R$ 4.200,00', 'Entregue']
        ]
    },
    'cargas-entregues-dta': {
        name: 'Cargas Entregues DTA',
        description: 'Relatório de cargas entregues com DTA',
        fields: '001*,002*,003,004,006,008,018',
        icon: 'fa-file-alt',
        color: 'info',
        columns: ['ID', 'DTA', 'Cliente', 'Data Entrega', 'Valor'],
        sampleData: [
            ['001', 'DTA-2024-001', 'Empresa ABC Ltda', '2024-01-15', 'R$ 5.000,00'],
            ['002', 'DTA-2024-002', 'Comércio XYZ S/A', '2024-01-20', 'R$ 3.500,00'],
            ['003', 'DTA-2024-003', 'Indústria DEF Ltda', '2024-01-25', 'R$ 4.200,00']
        ]
    },
    'cargas-recebidas-natureza': {
        name: 'Cargas Recebidas por Natureza',
        description: 'Relatório de cargas recebidas por natureza',
        fields: '001*,002,003*,017,018',
        icon: 'fa-warehouse',
        color: 'warning',
        columns: ['ID', 'Natureza', 'Cliente', 'Data Recebimento', 'Valor'],
        sampleData: [
            ['001', 'Importação', 'Empresa ABC Ltda', '2024-01-15', 'R$ 5.000,00'],
            ['002', 'Exportação', 'Comércio XYZ S/A', '2024-01-20', 'R$ 3.500,00'],
            ['003', 'Nacional', 'Indústria DEF Ltda', '2024-01-25', 'R$ 4.200,00']
        ]
    },
    'custodia': {
        name: 'Custódia',
        description: 'Relatório de cargas em custódia',
        fields: '001*,002,003*,018',
        icon: 'fa-shield-alt',
        color: 'warning',
        columns: ['ID', 'Cliente', 'Data Entrada', 'Tipo Custódia', 'Status'],
        sampleData: [
            ['001', 'Empresa ABC Ltda', '2024-01-15', 'Custódia Judicial', 'Ativa'],
            ['002', 'Comércio XYZ S/A', '2024-01-20', 'Custódia Administrativa', 'Ativa'],
            ['003', 'Indústria DEF Ltda', '2024-01-25', 'Custódia Fiscal', 'Ativa']
        ]
    },
    'guias-canceladas': {
        name: 'Guias Canceladas',
        description: 'Relatório de guias canceladas',
        fields: '001*,002*,003*,018',
        icon: 'fa-times-circle',
        color: 'danger',
        columns: ['ID', 'Guia', 'Data Cancelamento', 'Motivo', 'Status'],
        sampleData: [
            ['001', 'GUI-2024-001', '2024-01-15', 'Erro de digitação', 'Cancelada'],
            ['002', 'GUI-2024-002', '2024-01-20', 'Cliente desistiu', 'Cancelada'],
            ['003', 'GUI-2024-003', '2024-01-25', 'Documentação incompleta', 'Cancelada']
        ]
    },
    'guias-emitidas-funcionarios': {
        name: 'Guias Emitidas por Funcionários',
        description: 'Relatório de guias emitidas por funcionários',
        fields: '001*,002*,003,018',
        icon: 'fa-user-tie',
        color: 'info',
        columns: ['Funcionário', 'Quantidade', 'Período', 'Valor Total'],
        sampleData: [
            ['João Silva', '25', 'Janeiro 2024', 'R$ 15.000,00'],
            ['Maria Santos', '18', 'Janeiro 2024', 'R$ 12.500,00'],
            ['Pedro Costa', '22', 'Janeiro 2024', 'R$ 18.200,00']
        ]
    },
    'guias-faturadas': {
        name: 'Guias Faturadas',
        description: 'Relatório de guias que foram faturadas',
        fields: '001*,002*,003,018',
        icon: 'fa-check-circle',
        color: 'success',
        columns: ['ID', 'Guia', 'Data Faturamento', 'Valor', 'Status'],
        sampleData: [
            ['001', 'GUI-2024-001', '2024-01-15', 'R$ 1.500,00', 'Faturada'],
            ['002', 'GUI-2024-002', '2024-01-20', 'R$ 2.300,00', 'Faturada'],
            ['003', 'GUI-2024-003', '2024-01-25', 'R$ 1.800,00', 'Faturada']
        ]
    },
    'pagamentos-estornados': {
        name: 'Pagamentos Estornados',
        description: 'Relatório de pagamentos estornados',
        fields: '001*,002*,003*,018',
        icon: 'fa-undo',
        color: 'danger',
        columns: ['ID', 'Cliente', 'Data Estorno', 'Valor', 'Motivo'],
        sampleData: [
            ['001', 'Empresa ABC Ltda', '2024-01-15', 'R$ 1.500,00', 'Erro de processamento'],
            ['002', 'Comércio XYZ S/A', '2024-01-20', 'R$ 2.300,00', 'Solicitação do cliente'],
            ['003', 'Indústria DEF Ltda', '2024-01-25', 'R$ 1.800,00', 'Duplicidade']
        ]
    },
    'processos-cancelados': {
        name: 'Processos Cancelados',
        description: 'Relatório de processos cancelados',
        fields: '001*,002*,003*,018',
        icon: 'fa-ban',
        color: 'danger',
        columns: ['ID', 'Processo', 'Data Cancelamento', 'Motivo', 'Status'],
        sampleData: [
            ['001', 'PROC-2024-001', '2024-01-15', 'Documentação incompleta', 'Cancelado'],
            ['002', 'PROC-2024-002', '2024-01-20', 'Cliente desistiu', 'Cancelado'],
            ['003', 'PROC-2024-003', '2024-01-25', 'Prazo vencido', 'Cancelado']
        ]
    },
    'quantidade-guias-funcionarios': {
        name: 'Quantidade Guias por Funcionários',
        description: 'Relatório de quantidade de guias por funcionários',
        fields: '001*,002*,003,018',
        icon: 'fa-chart-bar',
        color: 'info',
        columns: ['Funcionário', 'Quantidade', 'Período', 'Média Diária'],
        sampleData: [
            ['João Silva', '150', 'Janeiro 2024', '5.0'],
            ['Maria Santos', '120', 'Janeiro 2024', '4.0'],
            ['Pedro Costa', '180', 'Janeiro 2024', '6.0']
        ]
    },
    'relatorio-pagamentos-divergentes': {
        name: 'Relatório de Pagamentos Divergentes',
        description: 'Relatório de pagamentos com divergências',
        fields: '001*,002*,003*,018',
        icon: 'fa-exclamation-triangle',
        color: 'warning',
        columns: ['ID', 'Cliente', 'Valor Esperado', 'Valor Pago', 'Diferença'],
        sampleData: [
            ['001', 'Empresa ABC Ltda', 'R$ 1.500,00', 'R$ 1.450,00', 'R$ -50,00'],
            ['002', 'Comércio XYZ S/A', 'R$ 2.300,00', 'R$ 2.350,00', 'R$ 50,00'],
            ['003', 'Indústria DEF Ltda', 'R$ 1.800,00', 'R$ 1.800,00', 'R$ 0,00']
        ]
    },
    'servicos-faturamento': {
        name: 'Serviços x Faturamento',
        description: 'Análise de serviços versus faturamento',
        fields: '001*,002*,003*,006,007,008,009,018',
        icon: 'fa-calculator',
        color: 'success',
        columns: ['Serviço', 'Quantidade', 'Valor Unitário', 'Total'],
        sampleData: [
            ['Armazenagem', '150', 'R$ 50,00', 'R$ 7.500,00'],
            ['Movimentação', '300', 'R$ 25,00', 'R$ 7.500,00'],
            ['Inspeção', '75', 'R$ 100,00', 'R$ 7.500,00']
        ]
    },
    'validacao-cobrancas-esperadas': {
        name: 'Validação Cobranças Esperadas',
        description: 'Relatório de validação de cobranças esperadas',
        fields: '001*,002*,003*,018',
        icon: 'fa-search-dollar',
        color: 'primary',
        columns: ['ID', 'Cliente', 'Valor Esperado', 'Status', 'Observações'],
        sampleData: [
            ['001', 'Empresa ABC Ltda', 'R$ 1.500,00', 'Validado', 'OK'],
            ['002', 'Comércio XYZ S/A', 'R$ 2.300,00', 'Pendente', 'Aguardando documentação'],
            ['003', 'Indústria DEF Ltda', 'R$ 1.800,00', 'Divergente', 'Valor diferente']
        ]
    },
    'validacao-guias-pos-fechamento': {
        name: 'Validação Guias Pós-Fechamento',
        description: 'Relatório de validação de guias pós-fechamento',
        fields: '001*,002*,003*,018',
        icon: 'fa-clipboard-check',
        color: 'info',
        columns: ['ID', 'Guia', 'Data Fechamento', 'Status', 'Observações'],
        sampleData: [
            ['001', 'GUI-2024-001', '2024-01-15', 'Validada', 'Processo concluído'],
            ['002', 'GUI-2024-002', '2024-01-20', 'Pendente', 'Aguardando aprovação'],
            ['003', 'GUI-2024-003', '2024-01-25', 'Rejeitada', 'Documentação incompleta']
        ]
    },
    'validacao-guias-pre-fechamento': {
        name: 'Validação Guias Pré-Fechamento',
        description: 'Relatório de validação de guias pré-fechamento',
        fields: '001*,002*,003*,018',
        icon: 'fa-clipboard-list',
        color: 'warning',
        columns: ['ID', 'Guia', 'Data Validação', 'Status', 'Próxima Ação'],
        sampleData: [
            ['001', 'GUI-2024-001', '2024-01-15', 'Aprovada', 'Fechar processo'],
            ['002', 'GUI-2024-002', '2024-01-20', 'Pendente', 'Aguardar documentos'],
            ['003', 'GUI-2024-003', '2024-01-25', 'Rejeitada', 'Corrigir inconsistências']
        ]
    }
};

// ========================================
// FUNÇÕES PRINCIPAIS
// ========================================

let currentReportType = null;
let reportModal = null;
let configuredReports = [];

// Carregar relatórios configurados
function loadConfiguredReports() {
    const saved = localStorage.getItem('faturamentoReports');
    if (saved) {
        configuredReports = JSON.parse(saved);
    } else {
        // Relatórios padrão (mesmos do configurador)
        configuredReports = [
            { id: 'baixas-guias', name: 'Baixas de Guias', fields: '001*,002*,003,018' },
            { id: 'cargas-entregues', name: 'Cargas Entregues', fields: '001*,002*,003*,006,008,009,011,018' },
            { id: 'cargas-entregues-dta', name: 'Cargas Entregues DTA', fields: '001*,002*,003,004,006,008,018' },
            { id: 'cargas-recebidas-natureza', name: 'Cargas Recebidas por Natureza', fields: '001*,002,003*,017,018' },
            { id: 'custodia', name: 'Custódia', fields: '001*,002,003*,018' },
            { id: 'guias-canceladas', name: 'Guias Canceladas', fields: '001*,002*,003*,018' },
            { id: 'guias-emitidas-funcionarios', name: 'Guias Emitidas por Funcionários', fields: '001*,002*,003,018' },
            { id: 'guias-faturadas', name: 'Guias Faturadas', fields: '001*,002*,003,018' },
            { id: 'pagamentos-estornados', name: 'Pagamentos Estornados', fields: '001*,002*,003*,018' },
            { id: 'processos-cancelados', name: 'Processos Cancelados', fields: '001*,002*,003*,018' },
            { id: 'quantidade-guias-funcionarios', name: 'Quantidade Guias por Funcionários', fields: '001*,002*,003,018' },
            { id: 'relatorio-pagamentos-divergentes', name: 'Relatório de Pagamentos Divergentes', fields: '001*,002*,003*,018' },
            { id: 'servicos-faturamento', name: 'Serviços x Faturamento', fields: '001*,002*,003*,006,007,008,009,018' },
            { id: 'validacao-cobrancas-esperadas', name: 'Validação Cobranças Esperadas', fields: '001*,002*,003*,018' },
            { id: 'validacao-guias-pos-fechamento', name: 'Validação Guias Pós-Fechamento', fields: '001*,002*,003*,018' },
            { id: 'validacao-guias-pre-fechamento', name: 'Validação Guias Pré-Fechamento', fields: '001*,002*,003*,018' }
        ];
    }
    
    // Enriquecer com dados do sistema centralizado
    configuredReports = configuredReports.map(report => {
        if (window.ALL_REPORTS_DATA && window.ALL_REPORTS_DATA[report.id]) {
            const centralData = window.ALL_REPORTS_DATA[report.id];
            return {
                ...report,
                icon: centralData.icon,
                color: centralData.color,
                description: centralData.description || report.description || 'Relatório personalizado'
            };
        }
        return report;
    });
    
    // Carregar dropdown e cards
    loadDropdownOptions();
    loadReportCards();
}

// Carregar opções do dropdown
function loadDropdownOptions() {
    const select = document.getElementById('reportSelect');
    select.innerHTML = '<option value="">Selecione...</option>';
    
    configuredReports.forEach(report => {
        const option = document.createElement('option');
        option.value = report.id;
        option.textContent = report.name;
        select.appendChild(option);
    });
}

// Carregar cards de relatórios
function loadReportCards() {
    const grid = document.getElementById('reportsGrid');
    grid.innerHTML = '';
    
    configuredReports.forEach(report => {
        const reportData = faturamentoReportsData[report.id];
        if (reportData) {
            const card = createReportCard(report.id, reportData);
            grid.appendChild(card);
        }
    });
}

// Criar card de relatório
function createReportCard(reportId, reportData) {
    const card = document.createElement('div');
    card.className = 'report-card';
    card.setAttribute('data-report', reportId);
    
    card.innerHTML = `
        <div class="report-header">
            <button class="btn-favorite" onclick="toggleFavorite('${reportId}')" title="Adicionar aos favoritos">
                <i class="far fa-star"></i>
            </button>
        </div>
        <div class="report-icon">
            <i class="fas ${reportData.icon}"></i>
        </div>
        <div class="report-content">
            <h4>${reportData.name}</h4>
            <p>${reportData.description}</p>
            <div class="report-stats">
                <span class="stat-item">
                    <i class="fas fa-cog text-info"></i>
                    Campos: ${reportData.fields}
                </span>
            </div>
        </div>
        <div class="report-actions">
            <button class="btn btn-primary btn-sm" onclick="openReport('${reportId}')">
                <i class="fas fa-eye"></i> Visualizar
            </button>
            <button class="btn btn-outline-primary btn-sm" onclick="exportReport('${reportId}')">
                <i class="fas fa-download"></i> Exportar
            </button>
        </div>
    `;
    
    return card;
}

// Abrir relatório
function openReport(reportType) {
    console.log('Abrindo relatório de faturamento:', reportType);
    
    currentReportType = reportType;
    
    // Primeiro, tentar obter do sistema centralizado
    let report = null;
    if (window.ALL_REPORTS_DATA && window.ALL_REPORTS_DATA[reportType]) {
        const reportData = window.ALL_REPORTS_DATA[reportType];
        report = {
            name: reportData.name,
            description: reportData.description || 'Relatório personalizado',
            fields: reportData.fields,
            icon: reportData.icon,
            color: reportData.color,
            columns: getDefaultColumns(reportType),
            sampleData: getDefaultSampleData(reportType)
        };
    } else {
        // Fallback para dados locais
        report = faturamentoReportsData[reportType];
    }
    
    if (!report) {
        alert('Relatório não encontrado!');
        return;
    }
    
    // Configurar modal
    setupReportModal(report);
    
    // Abrir modal
    if (!reportModal) {
        reportModal = new bootstrap.Modal(document.getElementById('reportModal'));
    }
    reportModal.show();
}

// Funções utilitárias movidas para reports-utils.js

// Configurar modal do relatório
function setupReportModal(report) {
    document.getElementById('reportTitle').textContent = report.name;
    
    // Limpar tabela
    document.getElementById('reportTableHead').innerHTML = '';
    document.getElementById('reportTableBody').innerHTML = '';
    document.getElementById('reportTableContainer').style.display = 'none';
}

// Gerar relatório
function generateReport() {
    const report = faturamentoReportsData[currentReportType];
    if (!report) return;
    
    // Mostrar loading
    document.getElementById('loadingState').style.display = 'block';
    document.getElementById('reportTableContainer').style.display = 'none';
    
    // Simular geração do relatório
    setTimeout(() => {
        // Criar cabeçalho da tabela
        const thead = document.getElementById('reportTableHead');
        const headerRow = document.createElement('tr');
        report.columns.forEach(column => {
            const th = document.createElement('th');
            th.textContent = column;
            headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        
        // Criar dados da tabela
        const tbody = document.getElementById('reportTableBody');
        report.sampleData.forEach(rowData => {
            const row = document.createElement('tr');
            rowData.forEach(cellData => {
                const td = document.createElement('td');
                td.textContent = cellData;
                row.appendChild(td);
            });
            tbody.appendChild(row);
        });
        
        // Mostrar tabela
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('reportTableContainer').style.display = 'block';
    }, 1500);
}

// Exportar relatório
function exportReport(reportType) {
    console.log('Exportando relatório de faturamento:', reportType);
    alert('Funcionalidade de exportação será implementada em breve!');
}

// ========================================
// SISTEMA DE FAVORITOS
// ========================================

// Carregar favoritos
function loadFavorites() {
    const saved = localStorage.getItem('faturamentoFavorites');
    return saved ? JSON.parse(saved) : [];
}

// Salvar favoritos
function saveFavorites(favorites) {
    localStorage.setItem('faturamentoFavorites', JSON.stringify(favorites));
}

// Toggle favorito
function toggleFavorite(reportType) {
    const favorites = loadFavorites();
    const index = favorites.indexOf(reportType);
    
    if (index > -1) {
        favorites.splice(index, 1);
        updateFavoriteButton(reportType, false);
    } else {
        favorites.push(reportType);
        updateFavoriteButton(reportType, true);
    }
    
    saveFavorites(favorites);
    updateFavoritesSection();
}

// Atualizar botão de favorito
function updateFavoriteButton(reportType, isFavorite) {
    const card = document.querySelector(`[data-report="${reportType}"]`);
    if (!card) return;
    
    const btn = card.querySelector('.btn-favorite');
    const icon = btn.querySelector('i');
    
    if (isFavorite) {
        icon.className = 'fas fa-star';
        btn.title = 'Remover dos favoritos';
    } else {
        icon.className = 'far fa-star';
        btn.title = 'Adicionar aos favoritos';
    }
}

// Atualizar seção de favoritos
function updateFavoritesSection() {
    const favorites = loadFavorites();
    updateFavoritesSectionCentral(favorites, 'favoritesContainer', 'faturamento');
}

// Função createFavoriteCard movida para reports-utils.js

// Limpar todos os favoritos
function clearAllFavorites() {
    if (confirm('Tem certeza que deseja remover todos os favoritos?')) {
        saveFavorites([]);
        updateFavoritesSection();
        
        // Atualizar todos os botões de favorito
        document.querySelectorAll('.btn-favorite').forEach(btn => {
            const icon = btn.querySelector('i');
            icon.className = 'far fa-star';
            icon.parentElement.title = 'Adicionar aos favoritos';
        });
    }
}

// ========================================
// SISTEMA DE SELEÇÃO RÁPIDA
// ========================================

// Selecionar relatório do dropdown
function selectReportFromDropdown() {
    const select = document.getElementById('reportSelect');
    const openBtn = document.getElementById('openReportBtn');
    
    if (select.value) {
        openBtn.disabled = false;
        openBtn.innerHTML = '<i class="fas fa-eye me-2"></i>Abrir Relatório';
    } else {
        openBtn.disabled = true;
        openBtn.innerHTML = '<i class="fas fa-eye me-2"></i>Abrir Relatório';
    }
}

// Abrir relatório selecionado
function openSelectedReport() {
    const select = document.getElementById('reportSelect');
    const reportType = select.value;
    
    if (reportType) {
        openReport(reportType);
        // Scroll para o card do relatório
        const reportCard = document.querySelector(`[data-report="${reportType}"]`);
        if (reportCard) {
            reportCard.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            // Destacar o card temporariamente
            reportCard.style.border = '2px solid #007bff';
            reportCard.style.boxShadow = '0 0 15px rgba(0, 123, 255, 0.3)';
            
            setTimeout(() => {
                reportCard.style.border = '';
                reportCard.style.boxShadow = '';
            }, 2000);
        }
    }
}

// Inicializar página
document.addEventListener('DOMContentLoaded', function() {
    // O sistema de sincronização automática já carrega os relatórios
    // Apenas inicializar funcionalidades específicas do módulo
    
    // Carregar favoritos
    const favorites = loadFavorites();
    
    // Atualizar botões de favorito
    favorites.forEach(reportType => {
        updateFavoriteButton(reportType, true);
    });
    
    // Atualizar seção de favoritos
    updateFavoritesSection();
    
    // Inicializar dropdown
    selectReportFromDropdown();
});
</script>

<!-- Estilos movidos para reports.css -->
{% endblock %}
