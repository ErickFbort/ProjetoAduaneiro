{% extends "base.html" %}

{% block title %}Acompanhamento Despachante (Em aberto) - Web Cliente{% endblock %}

{% block body_class %}main-body{% endblock %}

{% block content %}
{% include 'partials/sidebar.html' %}

<main class="content main-content--shifted">
    <div class="content-section active">
        <div class="container-fluid">
            <!-- Header da página -->
            <div class="page-header">
                <div class="header-content">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-user-check fa-2x text-white me-3"></i>
                        <div class="header-text">
                            <h2>Acompanhamento Despachante (Em aberto)</h2>
                            <p class="page-subtitle">Acompanhe processos em aberto do despachante</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Barra de Pesquisa e Filtros -->
            <div class="search-section">
                <div class="search-input-group">
                    <form method="GET" class="search-form">
                        <div class="input-group">
                            <input type="text" 
                                   name="search" 
                                   id="searchInput"
                                   class="form-control search-input" 
                                   placeholder="Pesquisar por requisição, protocolo, DI, DTA...">
                            <button type="submit" class="btn btn-primary search-btn" id="searchBtn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                    <button type="button" class="btn btn-outline-secondary clear-btn" id="clearFilters">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Ações da Tabela -->
            <div class="table-actions">
                <div class="actions-left">
                    <button type="button" class="btn btn-outline-secondary" onclick="refreshTable()" title="Atualizar">
                        <i class="fas fa-sync-alt"></i> Atualizar
                    </button>
                </div>
                <div class="actions-right">
                    <div class="items-per-page-container">
                        <span class="items-label">Itens por página:</span>
                        <select class="form-select items-select" id="itemsPorPagina">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tabela de Acompanhamento -->
            <div class="table-container">
                <div class="table-responsive">
                    <table class="table table-hover acompanhamento-table" id="acompanhamentoTable">
                        <thead class="table-header">
                            <tr>
                                <th width="10%">Impo/Expo</th>
                                <th width="12%">Requisição</th>
                                <th width="12%">Protocolo</th>
                                <th width="15%">Criado em</th>
                                <th width="15%">Última Atualização</th>
                                <th width="12%">DI</th>
                                <th width="12%">DTA</th>
                                <th width="12%">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="acompanhamentoTableBody">
                            <!-- Dados serão carregados via JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Estado vazio -->
                <div class="empty-state d-none" id="emptyState">
                    <i class="fas fa-user-check fa-4x text-muted mb-3"></i>
                    <h5>Nenhum processo em aberto encontrado</h5>
                    <p>Não há processos em aberto que correspondam aos critérios de busca.</p>
                    <button class="btn btn-primary" id="clearFiltersEmpty">
                        <i class="fas fa-refresh"></i> Limpar Filtros
                    </button>
                </div>
            </div>

            <!-- Paginação -->
            <nav aria-label="Navegação de páginas" class="mt-4">
                <ul class="pagination justify-content-center" id="pagination">
                    <!-- Paginação será gerada via JavaScript -->
                </ul>
            </nav>
        </div>
    </div>
</main>

<!-- Modal de Detalhes do Processo -->
<div class="modal fade" id="detalhesProcessoModal" tabindex="-1" aria-labelledby="detalhesProcessoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detalhesProcessoModalLabel">
                    <i class="fas fa-info-circle me-2"></i>
                    Detalhes do Processo - <span id="processoRequisicao"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Informações Básicas -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0">Informações Básicas</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Tipo de Operação:</label>
                                    <span id="tipoOperacaoDetalhes"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Status:</label>
                                    <span id="statusDetalhes"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Requisição:</label>
                                    <span id="requisicaoDetalhes"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Protocolo:</label>
                                    <span id="protocoloDetalhes"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Data de Criação:</label>
                                    <span id="dataCriacaoDetalhes"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Última Atualização:</label>
                                    <span id="ultimaAtualizacaoDetalhes"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">DI:</label>
                                    <span id="diDetalhes"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">DTA:</label>
                                    <span id="dtaDetalhes"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Informações do Cliente e Despachante -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0">Cliente e Despachante</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Cliente:</label>
                                    <span id="clienteDetalhes"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Despachante:</label>
                                    <span id="despachanteDetalhes"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Observações -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0">Observações</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Observações Gerais:</label>
                            <p id="observacoesDetalhes" class="text-muted">Nenhuma observação disponível.</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Observações Internas:</label>
                            <p id="observacoesInternasDetalhes" class="text-muted">Nenhuma observação interna disponível.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <button type="button" class="btn btn-primary" id="editarProcesso">
                    <i class="fas fa-edit"></i> Editar Processo
                </button>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="{{ url_for('static', filename='js/acompanhamento_despachante.js') }}"></script>
{% endblock %}
{% endblock %}
